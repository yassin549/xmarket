# Railway Configuration for Xmarket
# ==================================

[build]
builder = "NIXPACKS"

# Backend Service
[[services]]
name = "backend"
source = "."
buildCommand = "pip install -r requirements.txt"
startCommand = "uvicorn backend.main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/health"

[services.env]
PORT = "8000"

# Orderbook Service
[[services]]
name = "orderbook"  
source = "."
buildCommand = "pip install -r requirements.txt"
startCommand = "uvicorn orderbook.main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/health"

[services.env]
PORT = "8001"

# Reality Engine Service
[[services]]
name = "reality-engine"
source = "./reality_engine"

[services.env]
PORT = "8002"
DATABASE_URL = "${{Postgres.DATABASE_URL}}"
REALITY_API_SECRET = "${{REALITY_API_SECRET}}"
BACKEND_URL = "${{RAILWAY_BACKEND_URL}}"
REDIS_URL = "${{Redis.REDIS_URL}}"
POLL_INTERVAL = "300"
LLM_MODE = "tinyLLama"
LLM_CALLS_PER_HOUR = "10"

# Frontend Service
[[services]]
name = "frontend"
source = "./frontend"
buildCommand = "npm install && npm run build"
startCommand = "npm run preview -- --host 0.0.0.0 --port $PORT"

[services.env]
PORT = "5173"
VITE_BACKEND_URL = "${{RAILWAY_BACKEND_URL}}"
VITE_ORDERBOOK_URL = "${{RAILWAY_ORDERBOOK_URL}}"
